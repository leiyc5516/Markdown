#### 计算机通信的基本原理

两个计算机通信需要IP+Port  192.168.11.12：3386

IP用来确定发送给那一台计算机，Port用来确认发送到计算机后，哪一个程序接受该信息

交换机（没有IP） 或则 路由器 （外网|固定IP）

路由器作为中间桥梁，内网的计算机需要将信息发送给路由器，路由器将得到的消息，通过映射的方法将，内部的IP转换为外部的IP在将信息发送到外网。

#### 协议的概念

#### B/S C/S

#### 分层模式

#### 协议格式

* 数据包格式
* 以太帧格式
* ARP数据包格式
* IP段格式
* TCP/UDP

#### NAT映射

#### 打洞机制

#### 套接字

#### TCP C/S模型

* 预备知识
* server.c
* client.c

------

#### 协议的概念

什么是协议？

* 从应用的角度讲，协议可以理解为相互制定的规则，是数据传输和数据解释的规则

* 假设，A，B双方都想要传输数据文件。相互约定：

  * 第一次传输文件名，接收方接收到文件名后，应答ok给传输方 
  * 第二次发送文件的尺寸，接收方接收到尺寸数据应答ok
  * 第三次传输文件内容，同样接收方接收到数据后应答ok表示文件  内容接收完毕

  由此，无论AB两个之间如何传递何种文件，都是通过三次数据传输完成，A，B之间形成一个简单的数据传输规则。双方都按照这样的规则执行文件的传输。这样约定的临时的规则可以称之为协议。

* 这种仅仅是在AB两者之间形成的协议，我们称之为**原始协议**，当这些协议被更多的人所准守，并在这个基础上不断的改进维护完善，最后形成一个稳定的，完整的协议，并且广泛的被运用到文件传输过程中。该协议就是一个标准的协议。

#### 典型的协议

* 传输层： 常见的TCP/UDP 协议
* 应用层： 常见的协议有HTTP协议，FTP协议。
* 网络层： 常见的协议有IP协议，ICMP协议，IGMP协议
* 网络接口层：ARP协议，RARP协议.

TCP传输控制协议：是一种面向连接的，可靠的，基于字节流的传输通信协议

UDP用户数据报协议:是OSI参考模型中一种面向连接的传输协议，提供面向事务的简单不可靠信息传递服务

HTTP 超文本传输协议：是互联网上应用最为广泛的网络协议

FTP协议：文件传输协议

IP协议：因特网互联协议

ICMP协议：是internet 控制报文协议，他是TCP/IP协议的一个子协议，用于在IP主机，路由器之间传递控制消息。

IGMP协议：是Internet组管理协议，是因特网协议家族的一个组播协议

####  计算机分层协议

OSI 七层模型

OSI 参考模型：物理层---->数据链路层---->网络层---->传输层---->会话层---->表示层---->应用层

TCP/IP模型：网络接口层---->网络层---->传输层---->应用层

物理层：主要是	定义物理设备标准，如网线的接口类型，光纤的接口类型，各种传输介质 的传输速率等，他主要的作用是传输比特流。

数据链路层：定义l如何让格式化的数据以帧为单位进行传输，以及如何让控制 对物理介质访问，这一层通常还提供错误检测和矫正。以保证数据传输的可靠性。

网络层：在位于不同的地理位置的网络中两个主机系统之间提供连接和路径选择。Internet的发展使得从世界各站点访问数据信息的用户大大增加。网络层管理者这一层的连接。

传输层：定义传输协议和端口号。一般工作是将上层的内容做打包，将下层的内容做解析分发到每个程序。

会话层：通过传输层建立数据传输通路，主要在你的系统之间发起会话或则直接接受会话请求。

表示层：可以确保一个系统应用层所发送的信息可以在另外一个系统读取到

应用层：是靠近用户的OSI 层，这一层是为用户程序提供网络服务。

#### 通信过程

![image-20200909220717672](E:\github\C语言\image-20200909220717672.png)

![image-20200909220807219](E:\github\C语言\image-20200909220807219.png)

![img](E:\github\C语言\watermark,image_d2F0ZXIvYmFpa2U5Mg==,g_7,xp_5,yp_5)

![img](E:\github\C语言\wKioL1c1sYjzp14iAAAdnNHsDqg815.png)

![](E:\github\C语言\image-20200909224227871.png)

![image-20200909224307362](E:\github\C语言\image-20200909224307362.png)

![image-20200909225733675](E:\github\C语言\image-20200909225733675.png)

![image-20200909230005951](E:\github\C语言\image-20200909230005951.png)

#### NAT 映射

![image-20200909230547629](E:\github\C语言\image-20200909230547629.png)

#### 打洞机制

![image-20200909232031230](E:\github\C语言\image-20200909232031230.png)